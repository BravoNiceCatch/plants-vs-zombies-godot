[根目录](../../../CLAUDE.md) > [ccpm](../../) > **agents**

## 变更记录 (Changelog)
- 2025-11-23 08:22:13 - 初始化agents模块文档

## 模块职责

AI代理系统是CCPM的核心执行层，负责专门化的任务处理。每个代理具有特定的角色定位、工具集和输出格式，确保在特定领域的任务处理上具有高度专业性和效率。

## 代理类型与功能

### 1. code-analyzer (代码分析代理)
**文件**: `code-analyzer.md`

**主要职责**:
- 代码变更审查与bug检测
- 逻辑流程追踪与分析
- 安全漏洞识别
- 代码质量评估

**适用场景**:
- 代码重构后的质量检查
- 新功能实现的bug审查
- 生产问题的根因分析
- 代码安全审计

**输出格式**:
- Bug Hunt Summary (关键发现)
- Potential Issues (潜在问题)
- Verified Safe (安全验证)
- Logic Trace (逻辑追踪)
- Recommendations (修复建议)

**专用工具**: Glob, Grep, LS, Read, WebFetch, TodoWrite, WebSearch, Search, Task, Agent

### 2. parallel-worker (并行执行代理)
**文件**: `parallel-worker.md`

**主要职责**:
- 管理多个并行工作流
- 协调子代理执行
- 整合多线程结果
- 工作树环境管理

**适用场景**:
- 复杂Issue的并行分解
- 多文件同时修改
- 不同组件同步开发
- 依赖任务协调

**工作流程**:
1. 读取并理解Issue需求
2. 识别可并行的工作流
3. 启动子代理处理各自任务
4. 协调执行过程，处理依赖关系
5. 整合结果，提供总结报告

**专用工具**: Glob, Grep, LS, Read, WebFetch, TodoWrite, WebSearch, BashOutput, KillBash, Search, Task, Agent

### 3. file-analyzer (文件分析代理)
**文件**: `file-analyzer.md`

**主要职责**:
- 文件变更分析
- 依赖关系映射
- 影响范围评估
- 文件系统结构分析

**适用场景**:
- 文件变更影响评估
- 项目结构分析
- 依赖关系梳理
- 代码组织优化

### 4. test-runner (测试执行代理)
**文件**: `test-runner.md`

**主要职责**:
- 测试套件执行
- 测试结果分析
- 测试覆盖率评估
- 测试失败诊断

**适用场景**:
- 回归测试执行
- 新功能测试验证
- 性能测试分析
- 集成测试协调

## 代理协作模式

### 主从模式
- **主代理**: parallel-worker 负责整体协调
- **从代理**: 其他专门代理处理具体任务
- **通信方式**: 通过Task工具进行代理间通信

### 并行执行模式
```
Issue #1234: 用户认证系统
├── Stream 1: 数据库层 (code-analyzer)
├── Stream 2: API接口 (file-analyzer)
├── Stream 3: 前端组件 (code-analyzer)
└── Stream 4: 测试验证 (test-runner)
```

### 链式协作模式
1. **分析阶段**: file-analyzer 识别影响范围
2. **开发阶段**: code-analyzer 进行代码实现
3. **测试阶段**: test-runner 验证功能正确性
4. **整合阶段**: parallel-worker 协调整体合并

## 代理配置规范

### Frontmatter 要求
每个代理必须包含标准frontmatter:
```yaml
---
name: [代理名称]
description: [代理功能描述与使用场景]
tools: [工具列表]
model: [模型配置]
color: [标识颜色]
---
```

### 工具权限配置
- **Read系列**: 文件读取权限 (Read, LS, Glob)
- **分析系列**: 代码分析权限 (Grep, Search)
- **执行系列**: 任务执行权限 (Task, Agent)
- **外部系列**: 外部资源权限 (WebFetch, WebSearch)

### 输出格式标准
- 结构化输出，使用清晰分段
- 关键信息前置，细节内容后置
- 使用一致的状态指示符
- 提供具体的行动建议

## 上下文管理

### 上下文隔离
- 每个代理维护独立上下文
- 避免主线程被实现细节污染
- 保持上下文精简高效

### 上下文共享
- 通过文件系统共享状态
- 使用统一的数据格式
- 维护清晰的接口契约

### 上下文恢复
- 支持会话中断后的上下文恢复
- 使用持久化存储关键状态
- 提供上下文重建机制

## 性能优化

### 执行效率
- 限制单个代理的执行范围
- 优化工具调用频率
- 使用缓存减少重复操作

### 资源管理
- 合理分配内存和计算资源
- 避免代理间资源竞争
- 及时释放无用资源

### 并行度控制
- 根据系统资源调整并行代理数量
- 避免过度并行导致的性能下降
- 动态调整并行策略

## 错误处理

### 错误分类
- **执行错误**: 代理运行时异常
- **协作错误**: 代理间通信失败
- **资源错误**: 系统资源不足
- **权限错误**: 工具访问受限

### 恢复策略
- 自动重试机制
- 降级处理方案
- 人工干预接口
- 状态回滚支持

### 错误报告
- 结构化错误信息
- 可操作的解决方案
- 错误上下文保留
- 改进建议提供

## 监控与调试

### 执行监控
- 代理执行状态跟踪
- 资源使用情况监控
- 性能指标收集
- 异常情况报警

### 调试支持
- 详细执行日志
- 调试模式开关
- 步进执行功能
- 状态快照导出

### 性能分析
- 执行时间分析
- 资源消耗分析
- 瓶颈识别优化
- 趋势分析报告

## 扩展指南

### 新增代理
1. 创建代理定义文件
2. 实现核心功能逻辑
3. 定义专用工具集
4. 测试代理功能
5. 更新文档说明

### 代理优化
- 分析执行性能
- 优化工具使用
- 改进输出格式
- 增强错误处理

### 集成测试
- 单代理功能测试
- 多代理协作测试
- 性能压力测试
- 异常场景测试

## 相关文件清单

- `code-analyzer.md` - 代码分析代理定义
- `parallel-worker.md` - 并行执行代理定义
- `file-analyzer.md` - 文件分析代理定义
- `test-runner.md` - 测试执行代理定义
- `../rules/agent-coordination.md` - 代理协调规则
- `../scripts/test-and-log.sh` - 测试执行脚本
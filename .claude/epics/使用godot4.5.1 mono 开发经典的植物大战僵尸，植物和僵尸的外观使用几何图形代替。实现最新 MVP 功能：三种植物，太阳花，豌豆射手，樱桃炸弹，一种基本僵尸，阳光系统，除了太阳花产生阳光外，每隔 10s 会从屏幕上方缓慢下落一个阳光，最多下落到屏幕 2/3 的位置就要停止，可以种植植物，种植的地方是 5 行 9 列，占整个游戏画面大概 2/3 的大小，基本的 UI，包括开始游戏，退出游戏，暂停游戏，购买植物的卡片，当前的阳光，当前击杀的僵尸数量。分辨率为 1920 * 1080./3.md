---
name: 核心系统开发
status: open
created: 2025-11-23T00:45:07Z
updated: 2025-11-23T02:28:14Z
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task: 核心系统开发

## Description
实现游戏的核心管理系统，包括游戏管理器、网格系统和状态机，为所有游戏逻辑提供基础架构支撑。

## Acceptance Criteria
- [ ] 实现 GameManager 单例类，管理游戏状态、阳光数量、击杀计数
- [ ] 创建 GridSystem 系统，实现 5x9 种植网格的坐标转换和管理
- [ ] 实现游戏状态机，支持菜单、游戏中、暂停、游戏结束等状态转换
- [ ] 建立事件系统，使用 Godot 信号机制实现组件间通信
- [ ] 创建基础的游戏循环和帧更新机制
- [ ] 实现简单的调试输出和日志系统

## Technical Details

### GameManager 类
```csharp
public class GameManager : Node
{
    public static GameManager Instance { get; private set; }

    public enum GameState { Menu, Playing, Paused, GameOver, Victory }
    public GameState CurrentState { get; private set; }

    public int CurrentSunlight { get; set; }
    public int KillCount { get; set; }

    public void ChangeState(GameState newState);
    public void StartGame();
    public void PauseGame();
    public void ResumeGame();
    public void EndGame(bool victory);
}
```

### GridSystem 类
```csharp
public class GridSystem : Node2D
{
    public const int ROWS = 5;
    public const int COLS = 9;
    public const int CELL_SIZE = 80;

    public Vector2 GridToWorld(int row, int col);
    public Vector2Int WorldToGrid(Vector2 worldPos);
    public bool IsValidGridPosition(int row, int col);
    public bool IsOccupied(int row, int col);
    public Plant GetPlantAt(int row, int col);
    public void SetPlantAt(int row, int col, Plant plant);
}
```

### 状态机实现
- 使用枚举定义游戏状态
- 状态转换验证和事件触发
- 每个状态的进入、更新、退出逻辑

### 事件系统
- 定义自定义信号：游戏状态改变、阳光数量变化、僵尸击杀等
- 实现松耦合的组件通信机制
- 支持事件的注册、触发和取消注册

## Dependencies
- [ ] Task 001: 项目基础搭建完成

## Effort Estimate
- Size: M
- Hours: 24
- Parallel: true (可与UI界面开发并行)

## Definition of Done
- [ ] GameManager 能够正确管理游戏状态转换
- [ ] GridSystem 能够正确处理网格坐标转换
- [ ] 状态机支持所有必需的游戏状态
- [ ] 事件系统能够正确触发和处理信号
- [ ] 核心系统通过单元测试
- [ ] 代码遵循 C# 编码规范
- [ ] 代码完成并通过集成测试